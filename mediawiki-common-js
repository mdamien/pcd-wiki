/* Tout JavaScript ici sera chargé avec chaque page accédée par n’importe quel utilisateur. */

/**
 * Script pour alterner entre plusieurs cartes de géolocalisation
 */
 
if(( mw.config.get('wgAction')=="view" || mw.config.get('wgAction')=="purge" || mw.config.get('wgAction')=="submit")) addOnloadHook(GeoBox_Init);
 
function GeoBox_Init(Element){ 
     if(!Element) Element = document.body; 
     var cont = getElementsByClass('img_toogle', Element, 'div');
     if(cont.length==0) return; 
     for (var i = 0,m=cont.length; i < m ; i++) {
          cont[i].id = 'img_toogle_' + i;
          var Boxes = getElementsByClass('geobox',cont[i]);
          var ToggleLinksDiv = document.createElement('ul');
          ToggleLinksDiv.id = 'geoboxToggleLinks_' + i;
          for(var a=0,l=Boxes.length;a<l;a++){
               var ThisBox = Boxes[a];
               ThisBox.id = 'geobox_' + i + "_" + a;
               ThisBox.style.borderTop='0';
               var ThisAlt = ThisBox.getElementsByTagName('img')[0].alt
               var toggle = document.createElement('a');
               toggle.id = 'geoboxToggle_' + i + "_" + a;
               toggle.appendChild(document.createTextNode(ThisAlt));
               toggle.href='javascript:;';
               toggle.onclick = function(){
                    GeoBox_Toggle(this);
                    return false;
               }
               var Li = document.createElement('li');
               Li.appendChild(toggle);
               ToggleLinksDiv.appendChild(Li);
               if(a==(l-1)){
                    Li.style.display = "none";
               }else{
                    ThisBox.style.display = "none";
               }
          }
          cont[i].appendChild(ToggleLinksDiv);
     }
}
 
function GeoBox_Toggle(link){
     var ImgToggleIndex = link.id.split('geoboxToggle_').join('').replace(/_.*/g, "");
     var GeoBoxIndex = link.id.replace(/.*_/g, "");
     var ImageToggle = document.getElementById('img_toogle_' + ImgToggleIndex);
     var Links = document.getElementById('geoboxToggleLinks_' + ImgToggleIndex);
     var Geobox = document.getElementById('geobox_' + ImgToggleIndex + "_" + GeoBoxIndex);
     var Link = document.getElementById('geoboxToggle_' + ImgToggleIndex + "_" + GeoBoxIndex);
     if( (!ImageToggle) || (!Links) || (!Geobox) || (!Link) ) return;
     var AllGeoboxes = getElementsByClass('geobox',ImageToggle);
     for(var a=0,l=AllGeoboxes.length;a<l;a++){
          if(AllGeoboxes[a] == Geobox){
               AllGeoboxes[a].style.display = "";
          }else{
               AllGeoboxes[a].style.display = "none";
          }
     }
     var AllToggleLinks = Links.getElementsByTagName('a');
     for(var a=0,l=AllToggleLinks.length;a<l;a++){
          if(AllToggleLinks[a] == Link){
               AllToggleLinks[a].parentNode.style.display = "none";
          }else{
               AllToggleLinks[a].parentNode.style.display = "";
          }
     }
}